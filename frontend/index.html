<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <title>Müqavilə forması</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="form-container">
    <div class="form-header">
        <img src="logo.png" alt="Logo" class="header-logo">
    </div>

    <form id="contractForm">
        <label>Ad:</label>
        <input name="first_name" required />

        <label>Soyad:</label>
        <input name="last_name" required />

        <label>Ata adı:</label>
        <input name="middle_name" required />

        <label>Doğum tarixi:</label>
        <input type="date" name="birth_date" required />

        <label>Əlaqə nömrəsi:</label>
        <input name="phone" required />

        <label>Cins:</label>
        <select name="gender" required>
            <option value="Kişi">Kişi</option>
            <option value="Qadın">Qadın</option>
        </select>

        <div id="questionsContainer" class="question-block"></div>

        <button type="submit">Müqavilələri yüklə (PDF)</button>
    </form>
</div>

<script>
    const questions = [
        "Avans ödənişi nə qədərdir?",
        "Əlavə qeydiniz varmı?",
        "Hər hansısa allergiyanız varmı?",
        "Hazırda hansı dərmanları qəbul edirsiniz?",
        "1-dən 10-a qədər ağrı səviyyəsini qiymətləndirin"
    ];

    const container = document.getElementById("questionsContainer");
    questions.forEach((question, index) => {
        const label = document.createElement("label");
        label.innerText = `Sual ${index + 1}: ${question}`;
        const input = document.createElement("input");
        input.name = `q${index}`;
        input.required = true;
        container.appendChild(label);
        container.appendChild(input);
    });

    document.getElementById("contractForm").onsubmit = async function(e) {
        e.preventDefault();

        const formData = new FormData(e.target);
        const answers = [];
        questions.forEach((_, index) => {
            answers.push(formData.get(`q${index}`));
        });

        const json = {
            first_name: formData.get("first_name"),
            last_name: formData.get("last_name"),
            middle_name: formData.get("middle_name"),
            birth_date: formData.get("birth_date"),
            phone: formData.get("phone"),
            gender: formData.get("gender"),
            answers: answers
        };

        const res = await fetch("/submit", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(json)
        });

        const blob = await res.blob();
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "contracts.zip";
        document.body.appendChild(a);
        a.click();
        a.remove();
    };
</script>

</body>
</html>
